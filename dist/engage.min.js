/*! engage - v0.9.0 - 2015-10-06
* Copyright (c) 2015 ; Licensed MIT */
window.engage=function(a){var b="http://146.191.107.189:8080",c=function(b,c){this.idSG=b,this.student=[],this.idPlayer=-1,a.extend(this,c)},d=function(a,b){this.idGameplay=a,this.scores=b},e=function(){};return e.loginStudent=function(d,e,f){var g=jQuery.Deferred(),h=b+"/SGaccess/",i={idSG:d,username:e,password:f};return a.post(h,JSON.stringify(i),null,"json").done(function(a){a.loginSuccess||g.reject("Login failed"),a.hasOwnProperty("version")||g.reject("Sorry this game is not public"),g.resolve(new c(d,a))}).fail(function(){g.reject("Could not login")}),g.promise()},e.guestLogin=function(d){var e=jQuery.Deferred(),f=b+"/SGaccess/",g={idSG:d,username:"",password:""};return a.post(f,JSON.stringify(g),null,"json").done(function(a){a.hasOwnProperty("version")||e.reject("Sorry this game is not public"),e.resolve(new c(d,a))}).fail(function(){e.reject("Could not login as guest")}),e.promise()},c.prototype.getLeaderboard=function(){var c=b+"/learninganalytics/leaderboard/seriousgame/"+this.idSG+"/version/"+this.version;return a.getJSON(c)},c.prototype.getGameDesc=function(){var c=b+"/seriousgame/"+this.idSG+"/version/"+this.version;return a.getJSON(c)},c.prototype.getBadgesWon=function(){var c=b+"/badges/seriousgame/"+this.idSG+"/version/"+this.version+"/player/"+this.idPlayer;return a.getJSON(c)},c.prototype.startGameplay=function(){var c,e=b+"/gameplay/start",f=jQuery.Deferred();return c=-1===this.idPlayer?{idSG:this.idSG,version:this.version,idStudent:this.student.id||0,params:this.params}:{idSG:this.idSG,version:this.version,idPlayer:this.idPlayer},a.ajax({url:e,method:"PUT",data:JSON.stringify(c)}).done(function(c){var e=b+"/gameplay/"+c+"/scores";a.getJSON(e).done(function(a){f.resolve(new d(c,a))}).fail(function(){f.reject("Could not get the scores")})}).fail(function(){f.reject("Could not start gameplay")}),f.promise()},d.prototype.assess=function(c,d){var e=b+"/gameplay/"+this.idGameplay+"/assessAndScore",f={action:c,value:d};return a.ajax({url:e,method:"PUT",data:JSON.stringify(f)})},d.prototype.endGameplay=function(c){var d=c?"win":"lose",e=b+"/gameplay/"+this.idGameplay+"/end/"+d;return a.ajax({url:e,method:"POST"})},d.prototype.getFeedback=function(){var c=b+"/gameplay/"+this.idGameplay+"/feedback/";return a.getJSON(c)},d.prototype.getScores=function(){var c=b+"/gameplay/"+this.idGameplay+"/scores/";return a.getJSON(c)},e}(jQuery);